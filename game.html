<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Street Racer: Urban Chaos - Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rajdhani', sans-serif;
            background: #000;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        #gameContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .hud {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        .hud-element {
            pointer-events: auto;
        }
        
        .speedometer {
            position: absolute;
            bottom: 40px;
            right: 40px;
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ff6b35;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }
        
        .speed-needle {
            width: 2px;
            height: 60px;
            background: #ff6b35;
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(-90deg);
            transition: transform 0.3s ease;
        }
        
        .damage-meter {
            position: absolute;
            top: 40px;
            left: 40px;
            width: 300px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ff6b35;
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .score-display {
            position: absolute;
            top: 40px;
            right: 40px;
            text-align: right;
        }
        
        .minimap {
            position: absolute;
            bottom: 40px;
            left: 40px;
            width: 200px;
            height: 200px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ff6b35;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .combo-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: bold;
            color: #ff6b35;
            text-shadow: 0 0 20px rgba(255, 107, 53, 0.8);
            opacity: 0;
            pointer-events: none;
        }
        
        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }
        
        .pause-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 150;
            backdrop-filter: blur(5px);
        }
        
        .menu-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid #ff6b35;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            min-width: 400px;
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            flex-direction: column;
        }
        
        .loading-bar {
            width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 20px;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .notification {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 107, 53, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 110;
        }
        
        .wanted-stars {
            position: absolute;
            top: 200px;
            right: 40px;
            display: flex;
            gap: 5px;
        }
        
        .star {
            width: 30px;
            height: 30px;
            color: #666;
            font-size: 24px;
            transition: color 0.3s ease;
        }
        
        .star.active {
            color: #ff6b35;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.8);
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- Game Canvas -->
        <canvas id="gameCanvas"></canvas>
        
        <!-- HUD -->
        <div class="hud">
            <!-- Damage Meter -->
            <div class="damage-meter">
                <h3 class="text-white font-bold mb-3">VEHICLE STATUS</h3>
                <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-300">Engine</span>
                        <span class="text-green-400" id="engineHealth">100%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-300">Body</span>
                        <span class="text-green-400" id="bodyHealth">100%</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-300">Wheels</span>
                        <span class="text-green-400" id="wheelHealth">100%</span>
                    </div>
                </div>
            </div>
            
            <!-- Score Display -->
            <div class="score-display">
                <div class="text-4xl font-bold text-white" style="font-family: 'Orbitron', monospace;" id="scoreDisplay">0</div>
                <div class="text-orange-400 font-bold" id="comboDisplay">COMBO x1</div>
                <div class="text-gray-300 text-sm mt-2" id="scoreMultiplier">Multiplier: 1.0x</div>
            </div>
            
            <!-- Speedometer -->
            <div class="speedometer">
                <div class="speed-needle" id="speedNeedle"></div>
                <div class="text-white text-2xl font-bold" style="font-family: 'Orbitron', monospace;" id="speedDisplay">0</div>
                <div class="text-orange-400 text-sm">KM/H</div>
            </div>
            
            <!-- Minimap -->
            <div class="minimap">
                <div class="p-2">
                    <h4 class="text-white text-sm font-bold mb-2">MINIMAP</h4>
                    <div class="relative w-full h-32 bg-gray-900 rounded">
                        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-orange-500 rounded-full" id="playerPosition"></div>
                    </div>
                </div>
            </div>
            
            <!-- Wanted Stars -->
            <div class="wanted-stars">
                <div class="star">â˜…</div>
                <div class="star">â˜…</div>
                <div class="star">â˜…</div>
                <div class="star">â˜…</div>
                <div class="star">â˜…</div>
            </div>
            
            <!-- Combo Display -->
            <div class="combo-display" id="comboPopup"></div>
            
            <!-- Notifications -->
            <div class="notification" id="notification"></div>
        </div>
        
        <!-- Pause Menu -->
        <div class="pause-menu" id="pauseMenu">
            <div class="menu-card">
                <h2 class="text-3xl font-bold text-white mb-8">PAUSED</h2>
                <div class="space-y-4">
                    <button onclick="resumeGame()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-lg font-bold text-lg">RESUME</button>
                    <button onclick="restartGame()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-lg font-bold">RESTART</button>
                    <button onclick="openOptions()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-lg font-bold">OPTIONS</button>
                    <button onclick="exitToMenu()" class="w-full bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-lg font-bold">EXIT TO MENU</button>
                </div>
            </div>
        </div>
        
        <!-- Game Over Screen -->
        <div class="game-over-screen" id="gameOverScreen">
            <div class="menu-card">
                <h2 class="text-4xl font-bold text-white mb-4">GAME OVER</h2>
                <div class="text-6xl mb-6">ðŸ’¥</div>
                <div class="text-2xl text-orange-400 mb-2">Final Score</div>
                <div class="text-5xl font-bold text-white mb-8" style="font-family: 'Orbitron', monospace;" id="finalScore">0</div>
                <div class="space-y-4">
                    <button onclick="restartGame()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-lg font-bold text-lg">PLAY AGAIN</button>
                    <button onclick="exitToMenu()" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-lg font-bold">BACK TO MENU</button>
                </div>
            </div>
        </div>
        
        <!-- Loading Screen -->
        <div class="loading-screen" id="loadingScreen">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-white mb-4" style="font-family: 'Orbitron', monospace;">LOADING</h1>
                <div class="text-orange-400 text-xl mb-4">Initializing Street Racer...</div>
                <div class="loading-bar">
                    <div class="loading-progress" id="loadingProgress"></div>
                </div>
                <div class="text-gray-400 text-sm mt-4" id="loadingText">Loading game assets...</div>
            </div>
        </div>
    </div>

    <script>
        // Game variables
        let scene, camera, renderer;
        let world;
        let car, carBody;
        let keys = {};
        let gameState = {
            speed: 0,
            score: 0,
            combo: 1,
            health: 100,
            wantedLevel: 0,
            isPaused: false,
            isGameOver: false
        };
        
        // Initialize Three.js scene
        function initThreeJS() {
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x000000, 10, 1000);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 20);
            
            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('gameCanvas'),
                antialias: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Create city environment
            createCity();
            
            // Create car
            createCar();
        }
        
        // Initialize physics world
        function initPhysics() {
            world = new CANNON.World();
            world.gravity.set(0, -9.82, 0);
            world.broadphase = new CANNON.NaiveBroadphase();
            world.solver.iterations = 10;
            
            // Ground
            const groundShape = new CANNON.Plane();
            const groundBody = new CANNON.Body({ mass: 0 });
            groundBody.addShape(groundShape);
            groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), -Math.PI / 2);
            world.add(groundBody);
        }
        
        // Create city environment
        function createCity() {
            // Ground
            const groundGeometry = new THREE.PlaneGeometry(1000, 1000);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Buildings
            for (let i = 0; i < 50; i++) {
                const buildingGeometry = new THREE.BoxGeometry(
                    Math.random() * 20 + 10,
                    Math.random() * 50 + 20,
                    Math.random() * 20 + 10
                );
                const buildingMaterial = new THREE.MeshLambertMaterial({ color: 0x666666 });
                const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
                
                building.position.x = (Math.random() - 0.5) * 400;
                building.position.y = building.geometry.parameters.height / 2;
                building.position.z = (Math.random() - 0.5) * 400;
                building.castShadow = true;
                building.receiveShadow = true;
                
                scene.add(building);
            }
            
            // Roads
            for (let i = 0; i < 10; i++) {
                const roadGeometry = new THREE.PlaneGeometry(1000, 10);
                const roadMaterial = new THREE.MeshLambertMaterial({ color: 0x222222 });
                const road = new THREE.Mesh(roadGeometry, roadMaterial);
                road.rotation.x = -Math.PI / 2;
                road.position.z = (i - 5) * 50;
                scene.add(road);
            }
        }
        
        // Create car
        function createCar() {
            const carGeometry = new THREE.BoxGeometry(4, 1, 8);
            const carMaterial = new THREE.MeshLambertMaterial({ color: 0xff6b35 });
            car = new THREE.Mesh(carGeometry, carMaterial);
            car.position.y = 1;
            car.castShadow = true;
            scene.add(car);
            
            // Car physics body
            const carShape = new CANNON.Box(new CANNON.Vec3(2, 0.5, 4));
            carBody = new CANNON.Body({ mass: 1000 });
            carBody.addShape(carShape);
            carBody.position.set(0, 1, 0);
            world.add(carBody);
        }
        
        // Game loop
        function animate() {
            if (gameState.isPaused || gameState.isGameOver) return;
            
            requestAnimationFrame(animate);
            
            // Update physics
            world.step(1/60);
            
            // Update car position
            car.position.copy(carBody.position);
            car.quaternion.copy(carBody.quaternion);
            
            // Handle input
            handleInput();
            
            // Update camera
            updateCamera();
            
            // Update HUD
            updateHUD();
            
            // Update score
            updateScore();
            
            renderer.render(scene, camera);
        }
        
        // Handle input
        function handleInput() {
            const force = 500;
            const torque = 200;
            
            if (keys['w'] || keys['W']) {
                carBody.applyForce(new CANNON.Vec3(0, 0, -force), carBody.position);
            }
            if (keys['s'] || keys['S']) {
                carBody.applyForce(new CANNON.Vec3(0, 0, force), carBody.position);
            }
            if (keys['a'] || keys['A']) {
                carBody.applyTorque(new CANNON.Vec3(0, torque, 0));
            }
            if (keys['d'] || keys['D']) {
                carBody.applyTorque(new CANNON.Vec3(0, -torque, 0));
            }
            
            // Calculate speed
            const velocity = carBody.velocity;
            gameState.speed = Math.sqrt(velocity.x ** 2 + velocity.z ** 2) * 3.6; // Convert to km/h
        }
        
        // Update camera
        function updateCamera() {
            const cameraDistance = 20;
            const cameraHeight = 10;
            
            camera.position.x = car.position.x - Math.sin(car.rotation.y) * cameraDistance;
            camera.position.y = car.position.y + cameraHeight;
            camera.position.z = car.position.z - Math.cos(car.rotation.y) * cameraDistance;
            
            camera.lookAt(car.position);
        }
        
        // Update HUD
        function updateHUD() {
            // Speed
            document.getElementById('speedDisplay').textContent = Math.round(gameState.speed);
            
            // Speed needle
            const maxSpeed = 200;
            const speedPercent = Math.min(gameState.speed / maxSpeed, 1);
            const needleRotation = -90 + (speedPercent * 180);
            document.getElementById('speedNeedle').style.transform = `translateX(-50%) rotate(${needleRotation}deg)`;
            
            // Score
            document.getElementById('scoreDisplay').textContent = Math.round(gameState.score);
            document.getElementById('comboDisplay').textContent = `COMBO x${gameState.combo}`;
            
            // Health
            const healthPercent = gameState.health;
            document.getElementById('engineHealth').textContent = `${healthPercent}%`;
            document.getElementById('bodyHealth').textContent = `${healthPercent}%`;
            document.getElementById('wheelHealth').textContent = `${healthPercent}%`;
            
            // Update health colors
            const healthElements = ['engineHealth', 'bodyHealth', 'wheelHealth'];
            healthElements.forEach(id => {
                const element = document.getElementById(id);
                if (healthPercent > 60) {
                    element.className = 'text-green-400';
                } else if (healthPercent > 30) {
                    element.className = 'text-yellow-400';
                } else {
                    element.className = 'text-red-400';
                }
            });
        }
        
        // Update score
        function updateScore() {
            // Base score from speed
            if (gameState.speed > 50) {
                gameState.score += gameState.speed * 0.1 * gameState.combo;
            }
            
            // Combo decay
            if (gameState.combo > 1) {
                gameState.combo = Math.max(1, gameState.combo - 0.001);
            }
        }
        
        // Show notification
        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.opacity = '1';
            
            setTimeout(() => {
                notification.style.opacity = '0';
            }, duration);
        }
        
        // Add score
        function addScore(points, reason = '') {
            gameState.score += points * gameState.combo;
            if (reason) {
                showNotification(`+${Math.round(points)} ${reason}`);
            }
        }
        
        // Increase combo
        function increaseCombo(amount = 0.1) {
            gameState.combo = Math.min(gameState.combo + amount, 10);
            showNotification(`COMBO x${Math.round(gameState.combo * 10) / 10}!`);
        }
        
        // Take damage
        function takeDamage(amount) {
            gameState.health = Math.max(0, gameState.health - amount);
            
            if (gameState.health <= 0) {
                gameOver();
            }
        }
        
        // Game over
        function gameOver() {
            gameState.isGameOver = true;
            document.getElementById('finalScore').textContent = Math.round(gameState.score);
            document.getElementById('gameOverScreen').style.display = 'flex';
        }
        
        // Pause/Resume functions
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            if (gameState.isPaused) {
                document.getElementById('pauseMenu').style.display = 'flex';
            } else {
                document.getElementById('pauseMenu').style.display = 'none';
                animate();
            }
        }
        
        function resumeGame() {
            gameState.isPaused = false;
            document.getElementById('pauseMenu').style.display = 'none';
            animate();
        }
        
        function restartGame() {
            location.reload();
        }
        
        function exitToMenu() {
            window.location.href = 'menu.html';
        }
        
        // Loading simulation
        function simulateLoading() {
            let progress = 0;
            const loadingProgress = document.getElementById('loadingProgress');
            const loadingText = document.getElementById('loadingText');
            
            const loadingSteps = [
                'Loading game assets...',
                'Initializing physics engine...',
                'Building city environment...',
                'Preparing vehicles...',
                'Starting engine...'
            ];
            
            let currentStep = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        animate();
                    }, 500);
                }
                
                loadingProgress.style.width = progress + '%';
                
                if (progress > (currentStep + 1) * 20 && currentStep < loadingSteps.length - 1) {
                    currentStep++;
                    loadingText.textContent = loadingSteps[currentStep];
                }
            }, 200);
        }
        
        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === 'Escape') {
                togglePause();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Initialize game
        document.addEventListener('DOMContentLoaded', () => {
            initThreeJS();
            initPhysics();
            simulateLoading();
            
            // Add some initial score for demo
            setTimeout(() => {
                addScore(100, 'Welcome Bonus');
            }, 2000);
        });
    </script>
</body>
</html>